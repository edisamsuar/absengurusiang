<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absen Guru</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="islamic-pattern"></div>
    
    <div class="header">
        <div class="logo-container">
            <img src="https://madinatuddiniyahbabussalam.dayah.id/media/2021.09/logo-dyah21.png" alt="Logo Dayah" class="logo">
        </div>
        <h1>Absen Kehadiran Guru</h1>
        <p>Dayah Madinatuddiniyah Babussalam</p>
    </div>
    
    <div class="container">
        <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
        </div>
        
        <div class="teacher-card">
            <img src="https://www.iconpacks.net/icons/2/free-user-icon-3297-thumb.png" alt="Foto Guru" class="teacher-photo">
            <div class="teacher-info">
                <div class="teacher-name">Tgk Syahrizal Putra</div>
                <div class="teacher-subject"><i class="fas fa-book"></i> Rombel: - </div>
            </div>
        </div>
        
        <div class="attendance-buttons">
            <button class="present-btn" id="present-btn">
                <i class="fas fa-check-circle"></i> Hadir
            </button>
            <button class="absent-btn" id="absent-btn">
                <i class="fas fa-times-circle"></i> Tidak Hadir
            </button>
        </div>
        
        <div class="replacement-input" id="replacement-input">
            <div class="input-group">
                <label for="replacement-teacher">
                    <i class="fas fa-user-plus"></i> Nama Guru Pengganti
                </label>
                <input type="text" id="replacement-teacher" placeholder="Masukkan nama guru pengganti">
            </div>
            <button class="submit-btn" id="submit-btn">
                <i class="fas fa-paper-plane"></i> Simpan
            </button>
        </div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Mengirim data...</p>
        </div>
        
        <div class="success-message" id="success-message">
            <i class="fas fa-check-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
            <p>Data kehadiran berhasil dikirim!</p>
        </div>
    </div>
    
    <div class="footer">
        &copy; 2025 Dayah Madinatuddiniyah Babussalam
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const presentBtn = document.getElementById('present-btn');
            const absentBtn = document.getElementById('absent-btn');
            const replacementInput = document.getElementById('replacement-input');
            const replacementTeacher = document.getElementById('replacement-teacher');
            const submitBtn = document.getElementById('submit-btn');
            const loading = document.getElementById('loading');
            const successMessage = document.getElementById('success-message');
            
            // Flag untuk mencegah multiple submission
            let isSubmitting = false;
            
            // Base URL Google Forms
            const baseFormUrl = "https://docs.google.com/forms/d/e/1FAIpQLSc6eTsMQKmprieOTIE9Pkbyc3dBS_FcupFgpWca7G4urW7bEA/formResponse";
            
            // Event listener untuk tombol Hadir
            presentBtn.addEventListener('click', function() {
                if (isSubmitting) return; // Mencegah multiple clicks
                
                isSubmitting = true;
                disableButtons();
                
                // Menampilkan loading
                loading.style.display = 'block';
                
                // URL untuk status Hadir
                const presentUrl = `${baseFormUrl}?usp=pp_url&entry.782687226=Tgk+Syahrizal+Putra&entry.905421824=Siang&entry.147793750=Hadir`;
                
                // Mengirim data menggunakan fetch API untuk mencegah redirect ganda
                fetch(presentUrl, {
                    mode: 'no-cors'
                })
                .then(() => {
                    // Tampilkan pesan sukses
                    loading.style.display = 'none';
                    successMessage.style.display = 'block';
                    
                    // Reset setelah 3 detik
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                        enableButtons();
                        isSubmitting = false;
                    }, 3000);
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Jika fetch gagal, coba redirect langsung
                    window.location.href = presentUrl;
                });
            });
            
            // Event listener untuk tombol Tidak Hadir
            absentBtn.addEventListener('click', function() {
                if (isSubmitting) return;
                
                replacementInput.classList.add('show');
                replacementTeacher.focus();
            });
            
            // Event listener untuk tombol Simpan (Tidak Hadir)
            submitBtn.addEventListener('click', function() {
                if (isSubmitting) return;
                
                if (replacementTeacher.value.trim() === '') {
                    alert('Harap masukkan nama guru pengganti!');
                    replacementTeacher.focus();
                    return;
                }
                
                isSubmitting = true;
                disableButtons();
                
                // Menampilkan loading
                loading.style.display = 'block';
                replacementInput.classList.remove('show');
                
                // Mengambil nama guru pengganti dan encode untuk URL
                const replacementName = encodeURIComponent(replacementTeacher.value.trim());
                
                // URL untuk status Tidak Hadir dengan guru pengganti
                const absentUrl = `${baseFormUrl}?usp=pp_url&entry.782687226=Tgk+Syahrizal+Putra&entry.905421824=Siang&entry.147793750=Tidak+Hadir&entry.1647198616=${replacementName}`;
                
                // Mengirim data menggunakan fetch API untuk mencegah redirect ganda
                fetch(absentUrl, {
                    mode: 'no-cors'
                })
                .then(() => {
                    // Tampilkan pesan sukses
                    loading.style.display = 'none';
                    successMessage.style.display = 'block';
                    
                    // Reset setelah 3 detik
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                        enableButtons();
                        isSubmitting = false;
                        replacementTeacher.value = '';
                    }, 30000);
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Jika fetch gagal, coba redirect langsung
                    window.location.href = absentUrl;
                });
            });
            
            // Fungsi untuk menonaktifkan tombol
            function disableButtons() {
                presentBtn.disabled = true;
                absentBtn.disabled = true;
                submitBtn.disabled = true;
            }
            
            // Fungsi untuk mengaktifkan kembali tombol
            function enableButtons() {
                presentBtn.disabled = false;
                absentBtn.disabled = false;
                submitBtn.disabled = false;
            }
            
            // Animasi shape floating
            const shapes = document.querySelectorAll('.shape');
            shapes.forEach(shape => {
                let x = Math.random() * 10 - 5;
                let y = Math.random() * 10 - 5;
                
                function animate() {
                    let currentX = parseFloat(shape.style.left || '0');
                    let currentY = parseFloat(shape.style.top || '0');
                    
                    shape.style.left = (currentX + x) + 'px';
                    shape.style.top = (currentY + y) + 'px';
                    
                    const rect = shape.getBoundingClientRect();
                    if (rect.left <= 0 || rect.right >= window.innerWidth) x = -x;
                    if (rect.top <= 0 || rect.bottom >= window.innerHeight) y = -y;
                    
                    requestAnimationFrame(animate);
                }
                
                animate();
            });
        });
    </script>
</body>
</html>